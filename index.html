<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Retro Cassette Player</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<style>
:root{
  --ink:#1b1b1b;
  --accent:#6a4a3a;
}
*{box-sizing:border-box}
body{
  margin:0;height:100vh;
  display:flex;justify-content:center;align-items:center;
  background:#e5e5e5;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:var(--ink);
}

/* ===== PLAYER ===== */
.player{
  position:relative;
  width:360px;
  padding:20px;
}

/* BACKGROUND */
.player::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(180deg,#fafafa,#e0e0e0);
  border-radius:34px;
  box-shadow:0 40px 120px rgba(0,0,0,.25);
  opacity:0;
  transform:scale(.96);
  transition:.8s cubic-bezier(.22,1,.36,1);
  z-index:-1;
}
.player.open::before{
  opacity:1;
  transform:scale(1);
}

/* ===== DECK LID (HINGE) ===== */
.deck-lid{
  height:160px;
  margin-bottom:14px;
  transform-origin:top center;
  transform:rotateX(0deg);
  transition:transform 1.1s cubic-bezier(.22,1,.36,1);
  perspective:1200px;
  cursor:pointer;
}
.lid-inner{
  height:100%;
  border-radius:26px;
  background:linear-gradient(180deg,#fafafa,#d6d6d6);
  box-shadow:0 30px 80px rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  justify-content:center;
}

/* SCREEN + LED */
.deck-screen{
  position:relative;
  font-size:12px;
  letter-spacing:.2em;
  padding:6px 28px 6px 16px;
  background:#111;
  color:#eee;
  border-radius:6px;
}

/* LED */
.led{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  width:8px;
  height:8px;
  border-radius:50%;
  background:#300;
  box-shadow:none;
  transition:.3s ease;
}
.player.playing .led{
  background:#ff2a2a;
  box-shadow:
    0 0 6px rgba(255,60,60,.8),
    0 0 14px rgba(255,60,60,.6);
}

.player.open .deck-lid{
  transform:rotateX(105deg);
}

/* ===== SLOT ===== */
.cassette-slot{
  height:26px;
  margin-bottom:10px;
  border-radius:12px;
  background:linear-gradient(180deg,#333,#111);
  box-shadow:inset 0 4px 8px rgba(0,0,0,.8);
}

/* ===== CASSETTE ===== */
.cassette{
  position:relative;
  background:linear-gradient(180deg,rgba(255,255,255,.6),rgba(170,170,170,.35));
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
  border:1px solid rgba(255,255,255,.7);
  box-shadow:0 20px 60px rgba(0,0,0,.35);
  cursor:pointer;
  overflow:hidden;

  opacity:0;
  transform:translateY(-140px) rotate(-90deg) scale(.95);
  transition:1.1s cubic-bezier(.22,1,.36,1);
}
.player.open .cassette{
  opacity:1;
  transform:translateY(-20px) rotate(-14deg) rotateX(18deg);
}
.player.open.settled .cassette{
  transform:translateY(0) rotate(0) rotateX(0);
}

/* SHINE */
.shine{
  position:absolute;
  inset:-40%;
  background:linear-gradient(
    120deg,
    transparent 30%,
    rgba(255,255,255,.55) 45%,
    transparent 60%
  );
  animation:shineIdle 8s ease-in-out infinite;
  pointer-events:none;
}
@keyframes shineIdle{
  0%{transform:translateX(-60%)}
  50%{transform:translateX(60%)}
  100%{transform:translateX(-60%)}
}
.cassette.playing .shine{
  animation:shinePlay 3s linear infinite;
}
@keyframes shinePlay{
  from{transform:translateX(-80%)}
  to{transform:translateX(80%)}
}

/* WINDOW */
.window{
  background:#111;
  border-radius:10px;
  padding:14px 18px;
}
.reels{display:flex;justify-content:space-between}
.reel{
  width:58px;height:58px;
  border-radius:50%;
  border:3px solid #cfcfcf;
}
.spin{animation:spin 1.25s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* PANEL */
.panel{
  max-height:0;
  opacity:0;
  transform:translateY(-12px);
  transition:.8s cubic-bezier(.22,1,.36,1);
  pointer-events:none;
}
.player.open .panel{
  max-height:900px;
  opacity:1;
  transform:none;
  pointer-events:auto;
}

.controls{
  display:flex;
  gap:10px;
  justify-content:center;
  margin-bottom:10px;
}
.controls button{
  border:none;
  border-radius:999px;
  height:38px;
  min-width:38px;
  background:#444;
  color:#fff;
}
</style>
</head>

<body>

<div class="player" id="playerWrap">

  <div class="deck-lid" onclick="togglePanel()">
    <div class="lid-inner">
      <div class="deck-screen">
        TAPE PLAYER
        <span class="led"></span>
      </div>
    </div>
  </div>

  <div class="cassette-slot"></div>

  <div class="cassette">
    <span class="shine"></span>
    <div class="window">
      <div class="reels">
        <div class="reel" id="reelL"></div>
        <div class="reel" id="reelR"></div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="controls">
      <button onclick="prev()">⏮</button>
      <button id="playBtn" onclick="togglePlay()">▶</button>
      <button onclick="next()">⏭</button>
    </div>
  </div>

</div>

<audio id="sndOpen" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5f8d6e3c0c.mp3" type="audio/mpeg">
</audio>

<div id="player"></div>

<script>
const tg = window.Telegram?.WebApp
function haptic(type="light"){
  try{ tg?.HapticFeedback.impactOccurred(type) }catch{}
}

let ytPlayer,isPlaying=false
const reelL=document.getElementById("reelL")
const reelR=document.getElementById("reelR")
const playBtn=document.getElementById("playBtn")
const cassette=document.querySelector(".cassette")
const playerWrap=document.getElementById("playerWrap")

function onYouTubeIframeAPIReady(){
  ytPlayer=new YT.Player("player",{height:"0",width:"0"})
}

function togglePanel(){
  const snd=document.getElementById("sndOpen")
  if(playerWrap.classList.contains("open")){
    playerWrap.classList.remove("open","settled")
    haptic("light")
  }else{
    snd.currentTime=0
    snd.play()
    haptic("medium")
    playerWrap.classList.add("open")
    setTimeout(()=>playerWrap.classList.add("settled"),900)
  }
}

function togglePlay(){
  if(!ytPlayer)return
  if(isPlaying){
    ytPlayer.pauseVideo()
    reelL.classList.remove("spin")
    reelR.classList.remove("spin")
    cassette.classList.remove("playing")
    playerWrap.classList.remove("playing")
    playBtn.textContent="▶"
    haptic("light")
    isPlaying=false
  }else{
    ytPlayer.playVideo()
    reelL.classList.add("spin")
    reelR.classList.add("spin")
    cassette.classList.add("playing")
    playerWrap.classList.add("playing")
    playBtn.textContent="⏸"
    haptic("rigid")
    isPlaying=true
  }
}
function next(){}
function prev(){}
</script>

</body>
</html>
